<!-- Fragment that shows the lists and tasks of a project -->
<!-- TODO currently shows all lists in database -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tasklistview with jQuery UI Sortable</title>

    <!-- Dependencys -->
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

    <th:block th:include="/fragments/AddNewListModal"></th:block>

    <!-- Style for this fragment -->
    <style>
        /* contains all lists */
        #sortableListContainer {
            list-style-type: none;
            padding: 0;
            float: left;
            margin-right: -999em;
        }

        /* horizontale ausrichtung des ListenContainers*/
        #sortableListContainer > li {
            float: left;
        }

        /*Task */
        .task {
            background: #fff;
            border: 1px solid #DDDDDD;
            margin-top: 15px;
            margin-bottom: 15px;
            margin-left: 15px;
            margin-right: 15px;
            padding: 0.4em;
            font-size: 17px;
            min-height: 75px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, .25);
            border-radius: 5px;
        }

        /* Spalte in der TaskContainer drinnen*/
        .spalte {
            padding-top: 0%;
            font-size: 17px;
            min-height: 500px;
            width: 270px;
            vertical-align: top;
        }

        /* Vorschau beim bewegen von Tasks */
        .highlightTask {
            opacity: 0.5;
            background-color: #333333;
            /* Wie Task */
            margin-top: 15px;
            margin-bottom: 15px;
            margin-left: 15px;
            margin-right: 15px;
            padding: 0.4em;
            min-height: 75px;
            border-radius: 5px;
        }

        /* Vorschau beim bewegen von Spalten */
        .highlightSpalte {
            opacity: 0.5;
            background-color: #333333;
            /* Wie spalte */
            height: 550px;
            width: 270px;
        }

        /*container für Tasks */
        .taskContainer {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 500px;
            min-width: 150px;
        }

        .spaltenkopf {
            height: 50px;
            background: rgba(25, 25, 25, .1);
        }

    </style>

    <!-- jquerry functions for this fragment -->
    <script>
        /*making sortable(drag and drop) work */
        $(document).ready(function() {
            /* Connect all lists */
            $("#sortableListContainer").sortable({
                placeholder: "highlightSpalte",

                //saves the new position when a list is moved
                update: function sendAjaxWhenListMoved(event, ui) {
                    var listOrder = $(this).sortable('serialize');
                    var jsonfile={json:JSON.stringify(listOrder)};

                    console.log("Liste bewegt!");
                    console.log("Data: "+listOrder);

                    // Post
                    $.ajax({
                        type: 'POST',
                        url: '/ajaxMovedList',
                        data: jsonfile,
                        dataType: "json"
                    });

                    console.log("ajax send!");
                }

            });

            // send intial order of lists when page is loaded(when list is added/deleted)
            $(function sendInitalListPosition() {
                var listOrder = $("#sortableListContainer").sortable('serialize');
                var jsonfile={json:JSON.stringify(listOrder)};

                console.log("Initale Listen Position!");
                console.log("Data: "+listOrder);

                // Post ajax
                $.ajax({
                    type: 'POST',
                    url: '/ajaxMovedList',
                    data: jsonfile,
                    dataType: "json"
                });

                console.log("ajax send!");
            });


            /* Connect all taskconatainer */
            $(".taskContainer").sortable({
                connectWith: ".taskContainer",
                placeholder: "highlightTask"

                //saves the new position when a task is moved
                update: function sendAjaxWhenTaskMoved(event, ui) {
                    var data = $(this).sortable('serialize');

                    console.log("Task bewegt!");

                    /* Post
                    $.ajax({
                        data: data,
                        type: 'POST',
                        url: '/TODO'
                    });
                    */
                }

            }).disableSelection();

            $(function sendInitalTaskPosition() {
                //TODO
            });

        });
    </script>

</head>

<body style="background-color:DimGray;">

<!--container der Spalten -->
<ul id="sortableListContainer" class="sortableListContainer">

    <!-- Loads Lists from database: uses contextvariable tasklists from Projectview when called in Projectview -->

    <!--/*@thymesVar id="tasklists" type="de.beatyourtask.beatyourtask.model.Tasklist"*/-->
    <!--suppress ThymeleafVariablesResolveInspection -->
    <li
            th:each="list: ${tasklists}" th:include="/fragments/listFragments :: listFragment"
            th:with="Titel=${list.listName}, Color=${list.color}"
            th:remove="tag"
    />


    <!-- Mock Listen zur veranschaulichung-->

    <!--Spalte (Listenelemnt des Containers)-->
    <li id="idspalte1" class="spalte" style="background-color:Tomato;">
        <div class="spaltenkopf">
            <p id="idSpaltenkopfTitel" style="color:white;">Mock Spalte 1</p>
        </div>
        <!--container der Tasks -->
        <ul id="sortableTaskContainer-1" class="taskContainer">
            <!-- Tasks (Listenelemnt des Containers)-->
            <li id="idtask1" class="task">Test1</li>
            <li id="idtask2" class="task">Test2</li>
        </ul>
    </li>

    <!--Spalte (Listenelemnt des Containers)-->
    <li id="idspalte2" class="spalte" style="background-color:Orange;">
        <div class="spaltenkopf">
            <p id="idSpaltenkopfTitel2" style="color:white;">Mock Spalte 2</p>
        </div>
        <!--container der Tasks -->
        <ul id="sortableTaskContainer-2" class="taskContainer">
            <!-- Tasks (Listenelemnt des Containers)-->
            <li id="idtask3" class="task">Test3</li>
            <li id="idtask4" class="task">Test4</li>
        </ul>
    </li>

    <!-- Ende Mock Listen -->

    <!-- button zum öffnen des Modals zum hinzufügen einer neuen Liste -->
    <input type="button" class="btn btn-secondary btn-pill btn-sm" id="addNewListButton" value="+" name="addList" data-toggle="modal"
           data-target="#newListModal"/>


</ul>


</body>
</html>